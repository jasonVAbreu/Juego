<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Render HTML a PNG (via Vercel API)</title>
<style>
  :root{--bg:#0b1020;--card:#fff;--ink:#0b1020;--muted:#61708a;--brand:#2f855a}
  *{box-sizing:border-box} body{margin:0;background:linear-gradient(160deg,#0b1020,#122038);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:#fff}
  .wrap{max-width:1100px;margin:32px auto;padding:0 16px}
  .card{background:var(--card);color:var(--ink);border-radius:18px;box-shadow:0 16px 40px rgba(0,0,0,.25);overflow:hidden}
  header{padding:18px 22px;background:#10223a;color:#e6f1ff}
  header h1{margin:0;font-size:20px;letter-spacing:.2px}
  .grid{display:grid;grid-template-columns:1.1fr 1fr;gap:0}
  .left{padding:18px;border-right:1px solid #eef2f6}
  .right{padding:18px}
  label{font-weight:700;font-size:13px;color:#334155}
  textarea{width:100%;height:320px;border:1px solid #d7dee7;border-radius:12px;padding:12px;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
  input[type="text"], input[type="number"]{width:100%;border:1px solid #d7dee7;border-radius:12px;padding:10px}
  .row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
  .btn{appearance:none;border:0;border-radius:999px;background:linear-gradient(135deg,#2f855a,#3dbb86);color:#fff;padding:12px 16px;font-weight:800;cursor:pointer;box-shadow:0 10px 22px rgba(61,187,134,.35)}
  .btn[disabled]{opacity:.6;cursor:not-allowed}
  .note{font-size:12px;color:#64748b;margin-top:8px}
  .preview{display:grid;place-items:center;min-height:360px;border:1px dashed #d7dee7;border-radius:12px;background:#f7faf9}
  .preview img{max-width:100%;border-radius:12px;box-shadow:0 8px 24px rgba(2,6,23,.15)}
  .row2{display:grid;grid-template-columns:2fr 1fr;gap:10px;margin-top:12px}
  .small{font-size:12px;color:#555}
  .footer{padding:14px 18px;background:#f4f7fb;color:#334155;font-size:12px}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <h1>Cliente web para <code>/api/html2png</code> (Vercel)</h1>
      </header>
      <div class="grid">
        <section class="left">
          <label for="endpoint">Endpoint</label>
          <input id="endpoint" type="text" value="https://png-dusky.vercel.app/api/html2png" />

          <div class="row" style="margin-top:10px">
            <div><label for="w">Ancho</label><input id="w" type="number" value="1080" /></div>
            <div><label for="h">Alto</label><input id="h" type="number" value="1080" /></div>
            <div><label for="s">Escala</label><input id="s" type="number" value="2" step="1" min="1" max="3" /></div>
          </div>

          <label for="html" style="display:block;margin-top:12px">HTML</label>
          <textarea id="html"><html><body style="margin:0"><div style="width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;font:900 56px system-ui;background:#f3f7f5">Hola PNG</div></body></html></textarea>

          <div class="row2">
            <button id="render" class="btn">Renderizar a PNG</button>
            <input id="filename" type="text" value="prueba.png" />
          </div>
          <p class="note">El PNG se descargará automáticamente. Si el endpoint no incluye cabeceras CORS, el navegador bloqueará la petición.</p>
        </section>
        <section class="right">
          <div class="preview" id="preview">
            <div class="small">Previsualización aparecerá aquí…</div>
          </div>
        </section>
      </div>
      <div class="footer">
        Sugerencia: si ves error de CORS, agrega en tu función <code>Access-Control-Allow-Origin: *</code> y maneja preflight <code>OPTIONS</code>.
      </div>
    </div>
  </div>

<script>
const $ = (id)=>document.getElementById(id);
const endpoint=$('endpoint'), w=$('w'), h=$('h'), s=$('s'), html=$('html'), btn=$('render'), preview=$('preview'), filename=$('filename');

async function render(){
  btn.disabled=true; btn.textContent='Renderizando…';
  preview.innerHTML='<div class="small">Procesando…</div>';
  try{
    const res = await fetch(endpoint.value.trim(), {
      method:'POST',
      headers:{ 'Content-Type':'application/json', 'Accept':'image/png' },
      body: JSON.stringify({ html: html.value, width: Number(w.value), height: Number(h.value), scale: Number(s.value) })
    });
    if(!res.ok){
      const txt = await res.text();
      throw new Error('HTTP '+res.status+' '+res.statusText+' → '+txt);
    }
    const blob = await res.blob();
    const url = URL.createObjectURL(blob);
    // preview
    preview.innerHTML='';
    const img = new Image(); img.src=url; img.alt='preview';
    preview.appendChild(img);
    // descarga
    const a=document.createElement('a'); a.href=url; a.download=filename.value || 'render.png';
    document.body.appendChild(a); a.click(); a.remove();
    setTimeout(()=>URL.revokeObjectURL(url), 20000);
  }catch(err){
    preview.innerHTML='<div class="small" style="color:#b91c1c">'+(err.message||err)+'</div>';
    console.error(err);
  }finally{
    btn.disabled=false; btn.textContent='Renderizar a PNG';
  }
}
btn.addEventListener('click', render);
</script>
</body>
</html>
